# 开发日志 (Changelog)

## [1.4.1] - 2025-12-27

### AI 战术分析系统增强 (Tactical AI Enhancement)

- **深度战术分析修复**: 解决了“深度战术分析”功能在部分环境下无法返回结果的问题。
- **解析逻辑鲁棒性优化**: 
    - 引入了正则匹配机制，支持对 AI 返回的 Markdown 代码块（不分大小写）进行精确解析。
    - 增加了键名自动归一化处理，能够兼容 AI 可能输出的本地化键名（如“生存指南”）或蛇形命名法。
- **SDK 通讯协议校准**: 修正了 Gemini 2.0 SDK 在 JSON 模式下对 `response_mime_type` 参数的底层配置要求，确保通讯链路稳定。
- **交互日志反馈增强**: 优化了无线电日志的汇报机制，当扫描由于 API 限制等原因失败时，能够提供更准确的“扫描异常”反馈。

## [1.4.0] - 2025-12-27

### 游戏启动与战区选择系统 (Game Launch & War Zone Selection)

- **全新战术启动页面 (Tactical Start Screen)**:
    - **视觉重构**: 引入了具有深邃感和动态 CSS 战术背景的启动页面，支持沉浸式的游戏开端。
    - **全方位中文化**: 移除了所有冗余的英文标签，界面完全回归中文，提升国内玩家体验。
    - **版本与链接整合**: 在页面右上角集成了版本号标签及 GitHub 仓库链接入口。
- **战区智能部署系统 (War Zone Deployment)**:
    - **附近战场一键接入**: 优化了地理定位逻辑，点击即可基于当前坐标快速初始化战场。
    - **全球真实城市搜索**: 接入 OpenStreetMap (Nominatim) API，通过实时匹配的下拉列表，支持在全球范围内精准搜索并部署到任何城市。
    - **手动经纬度部署**: 提供了经纬度手动输入模式，并与城市搜索模式互斥，满足精准坐标打击需求。
- **部署前哨扫描与验证 (Urban Area Verification)**:
    - **自动实地验证**: 在手动输入坐标部署前，系统会开启“卫星战术扫描”，检查目标区域的地理特征。
    - **非城市区域拦截**: 智能识别并拦截位于海洋、高山或荒野等无建筑区域的坐标，确保游戏始终在具备战术价值的人类活动区展开，防止部署失败。
- **UI 交互与反馈优化**:
    - **智能按钮校验**: 只有当选定有效城市或输入符合逻辑的经纬度时，“进入战区”按钮才会激活。
    - **战术加载动画**: 新增了“正在扫描卫星地图”的加载进度面板，提升部署环节的仪式感。
    - **音效同步**: 启动页面的所有交互（按钮点击、城市选中、验证报错）均已同步触发对应的 UI 音效。
- **全方位多语言支持 (Global Localization)**:
    - **四语同步方案**: 实现了中文、英文、日文、韩文四种语言的完整翻译覆盖。
    - **动态语言切换**: 支持在游戏过程中随时切换语言，所有 UI 文本、战术报告、内心活动、无线电通讯均会立即实时翻译。
    - **动态性别本地化**: 重构了单位属性，支持基于性别的个性化称呼（如 M/F, 男/女），确保不同文化背景下的称谓准确性。
    - **零硬编码化**: 彻底清理了代码中残余的硬编码中文字符串，包括按钮标签、搜索占位符及坐标分隔符，全部接入 i18n 框架。
- **视觉回归与本地化修复 (Visual & Localization Fixes)**:
    - **医疗兵图标修复**: 解决了 1.4.0 早期版本中医疗兵（Medic）图标由于逻辑嵌套错误而退化为平民图标的问题，现在医疗兵拥有专属的白底红十字圆形图标。
    - **硬编码残留清理**: 修复了“SELECT”、“Language”以及坐标范围分隔符“to”在英文模式下无法正确显示的问题。

## [1.3.3] - 2025-12-26

### 地图交互与数据韧性 (Map Interaction & Data Resilience)

- **地图数据多源回退 (Overpass Mirror Fallback)**: 实现了 Overpass API 的多镜像回退机制。当主服务器超时或不稳定时，系统会自动平滑切换至备用镜像，确保建筑物始终可加载、可交互。
- **战术分析稳定性增强**: 优化了建筑分析的容错能力。即使地理元数据获取失败，系统仍能基于实时单位数据完成分析，并会在通讯频道提供明确的故障恢复提示。
- **空投范围精细化**: 将空投武器的散布范围缩小至原先的 1/4（25%），并同步缩小了蓝色的空投预览圆圈，支持更精准的战术定点投放。
- **任务取消快捷键 (ESC Support)**:
  - **快捷取消**: 现在选中的任何任务（如空投、空袭等）都可以通过按下键盘 `ESC` 键立即取消，并自动回退至“观察移动”模式。
  - **焦点残留修复**: 彻底解决了按下 `ESC` 后按钮由于浏览器原生焦点环（Focus Ring）导致的残留亮边框问题，确保 UI 状态切换干净利落。
- **精确空袭系统深度改进 (Precision Airstrike Refinement)**:
  - **打击范围精细化**: 将空袭半径缩小 50%（`0.0006`），实现更精准的战术打击。
  - **动态战术弹坑**:
    - **视觉重构**: 废弃了外部图源，改用纯 CSS 生成的战术弹坑。解决了边缘黑边问题，并使视觉风格更加契合电子沙盘系统。
    - **地表撕裂特效**: 新增了基于种子随机生成的“地表撕裂”动态黑线，并配合呼吸式透明度动画，真实还原爆炸后的能量余烬。
    - **层级管理优化**: 建立了独立的“地面渲染层 (Crater Pane)”，确保弹坑始终位于所有交互标志物（如空投准星、单位图标）之下，不再遮挡操作。
  - **全方位本地化与反馈**:
    - **倒计时语音**: 新增了空袭倒计时高频“滴答”音效，并根据反馈二次增强了音量。
    - **UI 本地化**: 完整汉化了空袭宣告（“警告：空中打击”）和倒计时单位（“秒”），并修复了移动端的文字换行与对齐偏离问题。

## [1.3.2] - 2025-12-26

### 开源集成 (Open Source Integration)

- **GitHub 项目入口**: 在游戏顶部标题栏新增了 GitHub 图标，点击可直接跳转至 [Zombie-Crisis 开源项目地址](https://github.com/CyberPoincare/Zombie-Crisis)。
- **交互与视觉优化**:
  - 图标集成了 UI 点击音效，保持交互一致性。
  - 采用响应式设计，在不同屏幕尺寸下自动调整图标大小，并具备平滑的悬停高亮效果。

## [1.3.1] - 2025-12-26

### AI 驱动的深度战术分析 (AI-Powered Tactical Analysis)

- **Gemini 深度集成**: 接入 `gemini-2.0-flash` 稳定接口，为每个建筑生成独一无二的深度生存报告。
- **地理环境感知 (Geographic Context Integration)**:
  - **真实地标融合**: 自动提取并融合 OpenStreetMap 中的周边道路（如：西玉龙街）和地标建筑（如：四川中银大厦）信息。
  - **情境化生存指南**: Survival Guide 现在能根据真实的街道名称和交通状况，给出极具代入感的撤离或固守建议。
- **动态实战态势报告 (Dynamic Tactical Report)**:
  - 实时解析周边敌我态势（僵尸、士兵、平民数量），并由 AI 转化为冷峻、专业的军事化战场评估。
- **交互体验与系统优化**:
  - **物理级独立冷却**: 将战术分析冷却逻辑从全局重构为建筑个体级别（60秒独立冷却），支持玩家在多点位并行开展侦察。
  - **扫描状态反馈**: 新增了“🛰️ 深度扫描中...”的按钮加载状态及实时通讯日志（Radio Log）的进程提示。
  - **报告界面重构**: 优化了建筑巡视器（Inspector）的展示逻辑，采用模块化色块区分“生存指南”与“实战报告”，提升信息读取效率。

## [1.3.0] - 2025-12-26

### 音效系统深度增强 (Advanced Audio System)

- **全方位战场音效**:
  - **武器声效补全**: 修复了手枪和狙击步枪的静音问题，新增散弹枪、火箭筒和网枪的专属射击音效。
  - **平民语音互动**: 引入了基于性别和年龄的平民语音系统。平民现在会根据处境发出恐惧（Fear）、尖叫（Scream）、欢呼（Clap）或紧急求助（Urge/Shout）。
  - **感染者生物音效**: 新增僵尸咆哮（Roar）和啃咬（Bite）音效，提升战场恐怖氛围。
- **智能音频优先级系统 (Audio Priority System)**:
  - 实现了“选中单位优先”逻辑。当前选中的实体或发生在其附近的事件音效将自动获得更高优先级，确保关键反馈不会被背景杂音淹没。
- **环境交互音效**: 实现了音效的地理空间感应，根据实体所在位置和邻近威胁动态触发相应的环境语音。

### UI 交互优化 (UI Interaction)

- **任务栏智能切换**: 修复了部署任务后的交互延迟。现在点击任意部署按钮（如空投、空袭）后，按钮进入倒计时的同时，任务面板会自动立即切换回“观察移动”状态，方便玩家无缝继续操控地图。

## [1.2.0] - 2025-12-26

### 建筑交互与战术系统 (Building Interaction & Tactics)

- **交互式建筑选择**: 地图上的建筑物现在支持点击选中，并伴有动态高亮和边框控制。
- **建筑战术识别面板 (Building Inspector)**:
  - **实时战术分析**: 根据建筑物的 OpenStreetMap 类别（住宅、商业、工业等）自动生成“战术优势 (Pros)”与“战术缺陷 (Cons)”。
  - **安全性预估**: 系统自动评估建筑物在僵尸危机下的防守安全等级（Low/Medium/High/Very High）。
  - **沉浸式描述**: 为不同类型的建筑提供独特的战术背景说明，增强代入感。
- **动态建筑加载**:
  - **随动渲染**: 解决了移动地图或缩放时建筑不更新的问题。现在移动地图后，新区域的建筑会自动加载并变为可点击状态。
  - **增量同步**: 采用增量加载与去重技术，确保已探索区域的建筑持续保留。
- **环境物理与反馈增强**:
  - **室内速度修正**: 进入不同类型的建筑会根据实体类型（僵尸/平民/专业人员）获得不同的移动速度修正。
  - **边界切换反馈**: 实体进入或离开建筑物时，会触发专属的心声（Thought）和心情气泡（Mood Bubbles），如“寻找掩护”、“进入危险区”等。
- **UI 体验精简**: 移除了建筑信息面板中的冗余技术元数据，专注于展示对生存决策有价值的战术信息。

## [1.1.1] - 2025-12-25

### 移动端适配与优化 (Mobile Adaptation)

- **响应式界面全面覆盖**: 针对手机浏览器进行了深度适配，确保所有核心功能在小屏幕上均可正常使用。
- **通讯频道 (Radio Log) 优化**:
  - 移除了移动端隐藏逻辑，现在通讯频道在手机端默认可见。
  - 智能定位：移动端通讯频道自动上移，避免与底部任务栏重叠。
  - 响应式初始尺寸：根据屏幕宽度自动调整通讯窗口的大小。
- **任务栏 (Toolbar) 布局改进**:
  - **动态缩放**: 任务按钮在移动端自动缩小，并针对极窄屏幕（如 iPhone SE）进行了精细化尺寸调整。
  - **美化与排版**: 优化了金额（$）徽章和图标在小尺寸按钮中的排布，解决了覆盖和重叠问题。
  - **边缘无损显示**: 修复了选中状态（Selected）下的缩放动画 and 发光外框被容器截断的视觉缺陷。
- **交互体验增强**:
  - **无损滚动**: 移除了任务栏多余的滚动条，同时保留横向滑动切换功能。
  - **精简文字**: 在移动端自动切换更精简的按钮文本（如“暂停”代替“模拟暂停”），提升界面整洁度。

## [1.1.0] - 2025-12-25

### 新增特性

- **高度动态的环境化对话系统**
  - **地理位置感知**: 深度整合 OpenStreetMap 数据，实时提取街道、地标、建筑名称和区域信息。
  - **基于 Gemini 2.0 的无线电通讯**: 升级至 `gemini-2.0-flash` 且采用 `v1` 稳定接口。无线电对话现由 AI 动态生成，能根据当前街道（如：Broadway）和地标构建逼真的战场报告。
  - **社交感应与心声系统增强**: 
    - **平民人格化**: 扩充了平民内心活动库，增加关于往事回忆、家庭思念及生存需求（饥饿、水、情报）的描写。
    - **动态反应**: 平民现在能感应周边 20 米内的实体——发现援军（士兵/医疗兵）时会表达希望，遭遇僵尸贴身时会产生极度恐慌反应。
    - **情境化位置融合**: 所有的内心活动依然会随机融合其当前的地理坐标信息（如：具体的街道名、附近的地标）。
- **交互与界面优化 (UI/UX)**
  - **个体随机冒泡图标 (Bubbling System)**: 场景个体上方新增随机出现的表情气泡，直观呈现其当前的心理动态或生存意愿，并配合柔和浮动动画增强生动感。
  - **个体追踪系统**: 在人物信息面板中新增了“镜头跟踪”切换按钮，允许玩家一键锁定并跟随特定幸存者或队员。
  - **通讯日志稳定性**: 将缓存提升至 200 条，配合多层级唯一 ID 和智能节流机制，彻底解决记录跳变问题。
  - **API 网络优化**: 针对 OpenStreetMap (Nominatim) 增加了 1.1 秒强制请求节流，避免访问频率过快导致的连接被拒。

### 调整与优化

- **环境配置**: 优化了 API Key 的校验逻辑，提供了 `.env.example` 模板并重写了 `README.md`。
- **默认地点**: 游戏主战场迁移至 **纽约时代广场 (NYC Times Square)**。

## [1.0.0] - 2025-12-25

### 新增特性

- **交互式实时通讯频道**
  - 在无线电日志中点击队员姓名可立即在地图上定位并选中该单位。
  - 实现“镜头跟随”模式：点击定位后地图会锁定并跟随队员移动，保持其在视野中心。
  - 智能自动滚动：仅当玩家位于底部时才自动滚动新消息，方便阅读历史记录。
  - 窗口缩放功能：支持拖动频道窗口边缘或右上角来调整窗口大小。
- **高级语音系统**
  - 武装平民加入：平民一旦获得空投武器即可接入无线电频道并发布状态。
  - 误伤警报：增加了指挥部对友军误伤（空袭、爆炸）的语音警报。
  - 角色间吐槽：特种队员会根据周围环境对武装平民的“非专业”表现进行语音抱怨。
- **视觉效果增强**
  - 优化了射击线和医疗线的渲染逻辑，解决了镜头移动时的视觉错位问题。

### 优化与修复

- **地图交互**：增加了鼠标拖拽自动退出镜头跟随的功能，实现操作无缝切换。
- **性能优化**：改进了主循环中的实体状态同步逻辑。
- **大气音效**：增加了队员在空闲时的随机自言自语，增强战场沉浸感。

---
*注：本项目持续开发中。*
